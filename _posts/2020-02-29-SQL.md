---
layout: post
title: SQL
tags: [sql]
---

### 主键
作用是用来唯一标识一行。可以用一列，也可以用多列，总之是要唯一。

### select

**不带from子句的select语句**：可用来判断当前到数据库的连接是否有效。许多检测工具会执行一条`SELECT 1;`来测试数据库连接。 

**通配符**： `%`表示任何字符出现任意次数,`_`用途和百分号一样，只是只匹配单个字符，而不是多个。`[]`匹配括号中的单个字符，这个有点像正则表达式里那个方括号，比如`[jm]%`匹配任何j或者m开头的字符串。

**联结 join**：用联结而不要用子查询的方式，因为大多数DBMS处理联结要更快

**组合查询 union**：多数情况下，任何具有多个WHERE子句的SELECT语句都可以作为一个组合查询。

<!-- more -->

**分页**：数据量很大的时候，需要分页显示。 通过`LIMIT  OFFSET `子句实现 。

```sql
SELECT id, name, gender, score
FROM students
ORDER BY score DESC
LIMIT 3 OFFSET 0;
```

表示先按score倒序查询，然后分3页，显示第1页。因为结果集索引值从0开始，因此0就代表第一条数据，也就是会显示第一页，如果总共有10条数据，分3页要显示第二页的话，offset就是3，因为第二页的第一条数据的索引值是3。有对应的公式：`offset= pageSize * (pageIndex - 1) `。如果offset超过最大值，不会报错，会返回一个空的结果。

**聚合查询**：sql提供了专门的一些聚合函数进行统计总数，平均值之类的计算，这就叫聚合查询。比如count函数。

`SELECT AVG(score) average FROM students WHERE gender = 'M';`求所有男生的平均成绩

**分组查询**：比如统计一班的人数可以用`select count(*) from students where class_id=1，那统计其他的班的人数岂不每次都要改一下class_id？这个时候就可以用分组。

```sql
select count(*) from students group by class_id
```

而如果要统计各班男女个数，这个时候，首先要分班，然后还有分性别，然后统计每组数量。

```sql
SELECT class_id, gender, COUNT(*) num FROM students GROUP BY class_id, gender;
```

### 视图
即虚拟表。虚拟表只包含动态检索数据的查询，他本身并不包含数据。一些好处：
- 重用SQL语句
- 简化复杂的SQL操作
- 使用表的一部分而不是整个表
- 保护数据，可以授予用户访问表的特定部分，而不是整个表的访问权限
- 视图可以返回和地层表的格式不同的数据
要特别注意**性能问题**，因为不包含数据，所以每次使用都要进行所有的检索。如果有多个联结创建了复杂的视图或者嵌套了视图，性能可能会下降的很厉害。
```sql
CREATE VIEW some_table_name AS SELECT name, age from student
```
然后就可以some_table_name当作一个表来使用了

### 存储过程
编写存储过程比一般的SQL语句要难，因此很多管理员会限制编写存储过程，作为一个安全措施。